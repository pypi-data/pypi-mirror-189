"use strict";(self.webpackChunkjupyterlab_judge=self.webpackChunkjupyterlab_judge||[]).push([[342],{6342:(e,t,s)=>{s.r(t),s.d(t,{IJudgePanelFactoryRegistry:()=>z,IJudgeSignal:()=>G,IProblemProviderRegistry:()=>Y,default:()=>ne});var n=s(1210),o=s(4859),i=s(598),r=s(3992),a=s(152),l=s(1365),d=s(1034),u=s(9553),c=s(3773),m=s(4047);class h extends m.OutputArea{createOutputItem(e){const t=this.createRenderedMimetype(e);return t&&t.addClass("jp-OutputArea-output"),t}}var g=s(6271),p=s.n(g);const _="jupyterlab-judge",b="judgedrive",C=".jce-judge",y="jupyterlab-judge";var w;!function(e){function t(e,t){const s=t.load(_);function n(){if(e.context.model.readOnly)return(0,o.showDialog)({title:s.__("Cannot Save"),body:s.__("Document is read-only"),buttons:[o.Dialog.okButton({label:s.__("Ok")})]});e.context.save().then((()=>{if(!e.isDisposed)return e.context.createCheckpoint()}))}return(0,o.addToolbarButtonClass)(o.ReactWidget.create(g.createElement(o.UseSignal,{signal:e.context.fileChanged},(()=>g.createElement(o.ToolbarButtonComponent,{icon:a.saveIcon,onClick:n,tooltip:s.__("Save the judge contents and create checkpoint"),enabled:!!(e&&e.context&&e.context.contentsModel&&e.context.contentsModel.writable)})))))}function s(e,t){const s=t.load(_);return new o.ToolbarButton({icon:a.runIcon,onClick:()=>{e.execute()},tooltip:s.__("Run the code")})}function n(e,t){const s=t.load(_);return new o.ToolbarButton({icon:a.fileUploadIcon,onClick:()=>{e.judge()},tooltip:s.__("Judge the code")})}e.createSaveButton=t,e.createRunButton=s,e.createJudgeButton=n,e.getDefaultItems=function(e,i,r){return[{name:"save",widget:t(e,i)},{name:"run",widget:s(e,i)},{name:"interrupt",widget:o.Toolbar.createInterruptButton(e.session,i)},{name:"restart",widget:o.Toolbar.createRestartButton(e.session,r,i)},{name:"judge",widget:n(e,i)}]}}(w||(w={}));class v extends r.Panel{constructor(e){super(),this.propertyInspector=null,this._context=e.context,this._translator=e.translator,this._trans=this._translator.load(_),this._submitted=e.submitted,this.addClass("jp-JudgePanel"),this.id="jce-judge-panel",this.title.label=this._trans.__("Judge"),this.title.closable=!0;const t={model:this.model.codeModel,factory:new c.CodeMirrorEditorFactory({scrollbarStyle:"null"}).newInlineEditor,config:Object.assign(Object.assign({},e.editorConfig),{lineNumbers:!0})};this._editorWidget=new l.CodeEditorWrapper(t),this._markdownRenderer=e.rendermime.createRenderer("text/markdown"),this.renderProblem(),this.model.problemChanged.connect(((e,t)=>{this.renderProblem()})),this._outputArea=new h({model:this.model.outputAreaModel,rendermime:e.rendermime}),this.addWidget(this._markdownRenderer),this.addWidget(this._editorWidget),this.addWidget(this._outputArea),this.session.isReady||this.session.initialize()}get model(){return this.context.model}get editor(){return this._editorWidget.editor}get session(){return this.context.sessionContext}get context(){return this._context}renderProblem(){var e,t;this._markdownRenderer.renderModel(new u.MimeModel({data:{"text/markdown":null!==(t=null===(e=this.model.problem)||void 0===e?void 0:e.content)&&void 0!==t?t:this._trans.__("Problem Not Available.")}}))}handleEvent(e){this.model&&"mousedown"===e.type&&this._ensureFocus()}onAfterAttach(e){super.onAfterAttach(e),this.node.addEventListener("mousedown",this)}onBeforeDetach(e){this.node.removeEventListener("mousedown",this)}onActivateRequest(e){this._ensureFocus()}_ensureFocus(){this.session.pendingInput||this.editor.hasFocus()||this.editor.focus()}async execute(){if(this.session.hasNoKernel)return o.sessionContextDialogs.selectKernel(this.session),null;if(this.session.pendingInput)return(0,o.showDialog)({title:this._trans.__("Cell not executed due to pending input"),body:this._trans.__("The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again."),buttons:[o.Dialog.okButton({label:this._trans.__("Ok")})]}),null;const e=this.model.source;return await m.OutputArea.execute(e,this._outputArea,this.session,{})||null}async judge(){var e,t;const s=this.model.problem;if(null===s)throw new Error("Problem cannot be found.");const n=null===(e=this.session.session)||void 0===e?void 0:e.kernel;if(!n)return void o.sessionContextDialogs.selectKernel(this.session);const i=new o.SessionContext({sessionManager:this.session.sessionManager,specsManager:this.session.specsManager,name:"Judge"});await i.initialize(),await i.changeKernel(await n.spec);const r=null===(t=i.session)||void 0===t?void 0:t.kernel;if(!r)return void o.sessionContextDialogs.selectKernel(i);const a=await this.model.getTestCases(),l=[];this.model.submissionStatus={inProgress:!0,runCount:0,totalCount:a.length},this.showPropertyInspectorPanel();for(let e of a){const t=await this.runWithInput(r,s,e);l.push(t),this.model.submissionStatus={inProgress:!0,runCount:l.length,totalCount:a.length}}let d=null;const u=await this.model.validate(l.map((e=>e.output)));d=u.acceptedCount===u.totalCount?"AC":l.some((e=>"RE"==e.status))?"RE":l.some((e=>"OLE"==e.status))?"OLE":l.some((e=>"TLE"==e.status))?"TLE":"WA",await r.shutdown(),r.dispose();const c=await this.model.submit({problemId:s.id,status:d,code:this.model.source,cpuTime:l.map((e=>e.cpuTime)).reduce(((e,t)=>e+t),0)/l.length,acceptedCount:u.acceptedCount,totalCount:u.totalCount,token:u.token,language:"python",memory:0});this.model.submissionStatus={inProgress:!1,runCount:0,totalCount:0},this._submitted.emit({widget:this,submission:c,problem:s})}showPropertyInspectorPanel(){this.propertyInspector&&this.propertyInspector.showPanel()}async runWithInput(e,t,s,n=!1){const o={code:this.model.source,stop_on_error:!0,allow_stdin:!0};n&&await e.restart();const i=new Promise(((t,s)=>{const n=(s,o)=>{"idle"===o&&(e.statusChanged.disconnect(n),t())};"idle"===e.status?t():e.statusChanged.connect(n)}));await i;let r=[];r="one_line"===t.inputTransferType?s.split(/\r?\n/):[s];const a=Date.now(),l=e.requestExecute(o,!0,{});l.onStdin=e=>{if("input_request"==e.header.msg_type){const t=r.shift();l.sendInputReply({value:null!=t?t:"",status:"ok"},e.header)}};let d={output:"",status:"OK",cpuTime:0};l.onIOPub=e=>{switch(e.header.msg_type){case"stream":const t=e;"stdout"===t.content.name&&(d.output=d.output.concat(t.content.text));break;case"error":d.status="RE"}};const u=1e3*t.timeout,c=new Promise((e=>{setTimeout((()=>{e(0)}),1.2*u)}));if(0===await Promise.race([l.done,c]))l.dispose(),await e.interrupt(),d.status="TLE";else{const e=Date.now()-a;e>u?d.status="TLE":d.cpuTime=e}return d}}class f extends d.DocumentWidget{constructor(e){super(e),w.getDefaultItems(this.content,e.translator).forEach((e=>{this.toolbar.addItem(e.name,e.widget)}))}}class S extends d.ABCWidgetFactory{constructor(e){super(e.factoryOptions),this._rendermime=e.rendermime,this._commands=e.commands,this._editorConfig=e.editorConfig,this._judgePanelFactory=e.judgePanelFactory,this._submitted=e.submitted}createNewWidget(e){const t=this._judgePanelFactory({rendermime:this._rendermime,editorConfig:this._editorConfig,context:e,translator:this.translator,submitted:this._submitted});return t.title.icon=a.textEditorIcon,new f({content:t,context:e,commands:this._commands,translator:this.translator})}}var I,x=s(8878),P=s(1127),j=s(3559),M=s(8911),k=s(1840),E=s(8456);class T{constructor(e){this._contentChanged=new k.Signal(this),this._stateChanged=new k.Signal(this),this._isDisposed=!1,this._problemChanged=new k.Signal(this),this._submissionsChanged=new k.Signal(this),this._submissionStatus={inProgress:!1,runCount:0,totalCount:0},this._submissionStatusChanged=new k.Signal(this),this.modelDB=new M.ModelDB,this.sharedModel=new T.YJudge,this.sharedModel.changed.connect((async(e,t)=>{t.problemIdChange&&(this._problem=await this._problemProvider.getProblem(t.problemIdChange),this._problemChanged.emit(this._problem))})),this._codeModel=new E.CodeCellModel({}),this._codeModel.mimeType="text/x-python",this.sharedModel.ycodeCellChanged.connect(((e,t)=>{this._codeModel.switchSharedModel(t,!0)})),this._problem=null,this._problemProvider=e}get contentChanged(){return this._contentChanged}get stateChanged(){return this._stateChanged}get dirty(){return this.sharedModel.dirty}set dirty(e){e!==this.dirty&&(this.sharedModel.dirty=e)}get readOnly(){return!1}set readOnly(e){}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,k.Signal.clearData(this))}initialize(){}get defaultKernelName(){return`Judge: Problem ${this.sharedModel.getProblemId()}`}get defaultKernelLanguage(){return"python"}get codeModel(){return this._codeModel}get source(){return this.sharedModel.getSource()}set source(e){this.sharedModel.setSource(e)}get outputAreaModel(){return this._codeModel.outputs}get problem(){return this._problem}get problemChanged(){return this._problemChanged}async submissions(){return await this._problemProvider.getSubmissions(this.sharedModel.getProblemId())}get submissionsChanged(){return this._submissionsChanged}get submissionStatus(){return this._submissionStatus}set submissionStatus(e){this._submissionStatus=e,this._submissionStatusChanged.emit(this._submissionStatus)}get submissionStatusChanged(){return this._submissionStatusChanged}toString(){return JSON.stringify(this.toJSON())}fromString(e){try{this.fromJSON(JSON.parse(e))}catch(e){if(!(e instanceof SyntaxError))throw e;this.fromJSON({problem_id:"",code:"",judge_format:1})}}toJSON(){return{problem_id:this.sharedModel.getProblemId(),code:this.sharedModel.getSource(),judge_format:1}}fromJSON(e){var t,s;this.sharedModel.createCellModelFromSource(null!==(t=e.code)&&void 0!==t?t:"# 파일이 손상되었습니다. 파일을 삭제하고 새로 생성해주세요."),this.sharedModel.setProblemId(null!==(s=e.problem_id)&&void 0!==s?s:"")}async getTestCases(){return await this._problemProvider.getTestCases(this.sharedModel.getProblemId())}async validate(e){return await this._problemProvider.validate(this.sharedModel.getProblemId(),e)}async submit(e){const t=await this._problemProvider.submit(e);return this._submissionsChanged.emit(await this._problemProvider.getSubmissions(this.sharedModel.getProblemId())),t}}!function(e){e.JudgeModelFactory=class{constructor(e){this._disposed=!1,this._problemProviderFactory=e.problemProviderFactory}get name(){return"judge-model"}get contentType(){return"file"}get fileFormat(){return"text"}get isDisposed(){return this._disposed}dispose(){this._disposed=!0}preferredLanguage(e){return"python"}createNew(t,s){return new e(this._problemProviderFactory())}};class t extends P.YDocument{constructor(){super(),this.undoManager=new j.UndoManager([this._cell()],{trackedOrigins:new Set([this])}),this._yproblemId=this.ydoc.getText("problemId"),this._ycodeCellChanged=new k.Signal(this),this._yproblemId.observe((e=>{this._changed.emit({problemIdChange:this.getProblemId()})})),this._ycodeCell=null,this._cell().observe(((e,t)=>{e.changes.keys.get("id")&&this._switchCodeCell(this._cell())}))}createCellModelFromSource(e){this.transact((()=>{const t=this._cell();t.set("source",new j.Text(e)),t.set("metadata",{}),t.set("cell_type","code"),t.set("id",""),t.set("execution_count",0),t.set("outputs",new j.Array)})),this._switchCodeCell(this._cell())}_cell(){return this.ydoc.getMap("cell")}_switchCodeCell(e){const t=this._ycodeCell;this._ycodeCell=new s(e,this),this._ycodeCell.undoManager=this.undoManager,this.undoManager.clear(),this._ycodeCellChanged.emit(this._ycodeCell),this._ycodeCell.changed.connect(((e,t)=>{t.sourceChange&&(this.dirty=!0)})),null==t||t.dispose()}get changed(){return this._changed}get ycodeCellChanged(){return this._ycodeCellChanged}dispose(){}get yCodeCell(){return this._ycodeCell}getProblemId(){return this._yproblemId.toString()}setProblemId(e){this.transact((()=>{const t=this._yproblemId;t.delete(0,t.length),t.insert(0,e)}))}getSource(){var e,t;return null!==(t=null===(e=this._ycodeCell)||void 0===e?void 0:e.getSource())&&void 0!==t?t:""}setSource(e){this._ycodeCell&&this._ycodeCell.setSource(e)}}e.YJudge=t;class s extends P.YCodeCell{constructor(e,t){super(e),this._yjudge=t}get awareness(){return this._yjudge.awareness}}e.newFileContent=async function(e,t){var s,n;const o={problem_id:t,code:null!==(n=null===(s=await e.getProblem(t))||void 0===s?void 0:s.skeletonCode)&&void 0!==n?n:"# 여기에 입력하세요",judge_format:1};return JSON.stringify(o)}}(T||(T={})),function(e){e.open=`${y}:plugin:open`,e.openOrCreateFromId=`${y}:plugin:open-or-create-from-id`,e.execute=`${y}:plugin:execute`}(I||(I={}));var A=s(3856),F=s(8952),O=s(7968),N=s(4528),R=s(7667),D=s(3848),$=s(8671);function J(e){const t=(0,g.useContext)(q);let s=$.Time.formatHuman(new Date(e.submission.createdAt)),n=$.Time.format(new Date(e.submission.createdAt),"lll");return p().createElement("div",{className:"jce-judge-submission-item"},p().createElement(B,{status:e.submission.status,acceptedCount:e.submission.acceptedCount,totalCount:e.submission.totalCount}),p().createElement("div",{className:"jce-judge-submission-item-created-at",title:n},s),p().createElement(o.ToolbarButtonComponent,{onClick:()=>{e.setCode(e.submission.code)},label:t.__("Load"),tooltip:e.submission.code.substring(0,1e3)}))}function B(e){const t=(0,g.useContext)(q);let s="";switch(e.status){case"AC":s=`👍 ${t.__("Accepted")}`;break;case"WA":s=`❌ ${t.__("Wrong")} (${e.acceptedCount}/${e.totalCount})`;break;case"RE":s=`🚫 ${t.__("Error")}`;break;case"TLE":s=`🕓 ${t.__("Time Limit")}`;break;case"OLE":s=`👀 ${t.__("Output Limit")}`;break;case"IE":s=`☠ ${t.__("Please Try Again")}`}return p().createElement("div",{className:"jce-judge-submission-item-status"},s)}function W(e){const t=(0,D.useQueryClient)();return p().createElement(o.UseSignal,{signal:e.model.problemChanged,initialSender:e.model,initialArgs:e.model.problem},((s,n)=>p().createElement(o.UseSignal,{signal:e.model.submissionsChanged,initialSender:e.model},((s,o)=>{var i;const r=null!==(i=null==n?void 0:n.id)&&void 0!==i?i:null;return r&&t.invalidateQueries(["submissions",r]),p().createElement(L,{problemId:r,getSubmissions:async()=>{const t=await e.model.submissions();return null!=t?t:[]},setCode:t=>{e.model.source=t}})}))))}function L(e){const t=(0,g.useContext)(q);if(null===e.problemId)return p().createElement("div",{className:"jce-judge-submission-list-error"},"🚫 ",t.__("History Not Available"));const{data:s,isLoading:n}=(0,D.useQuery)(["submissions",e.problemId],e.getSubmissions);return n?p().createElement("div",{className:"jce-judge-submission-list-error"},"⌛ ",t.__("Loading History")):void 0===s?p().createElement("div",{className:"jce-judge-submission-list-error"},"🚫 ",t.__("History Not Available")):0===s.length?p().createElement("div",{className:"jce-judge-submission-list-error"},"🙅‍♀️ ",t.__("No History")):p().createElement(p().Fragment,null,s.map((t=>p().createElement(J,{submission:t,key:t.id,setCode:e.setCode}))))}function K(e){var t;const s=(0,g.useContext)(q),n=null!==(t=e.status)&&void 0!==t?t:{inProgress:!1,runCount:0,totalCount:0};return p().createElement("div",{className:"jce-judge-submission-status"},n.inProgress?`⌛ ${s.__("In Progress")} (${n.runCount}/${n.totalCount})`:`✔ ${s.__("No Submissions Judging")}`)}function U(e){const t=(0,g.useContext)(q);return null===e.model?p().createElement("div",null,t.__("No Submission History Found.")):p().createElement("div",{className:"jce-judge-submission-area"},p().createElement(o.UseSignal,{signal:e.model.submissionStatusChanged,initialSender:e.model,initialArgs:e.model.submissionStatus},((e,t)=>p().createElement(K,{status:null!=t?t:null}))),p().createElement(W,{model:e.model}))}const q=p().createContext(i.nullTranslator.load(_));class H extends o.ReactWidget{constructor(e){super(),this.queryClient=new D.QueryClient,this._tracker=e.tracker,this._translator=e.translator}render(){return p().createElement(q.Provider,{value:this._translator.load(_)},p().createElement(D.QueryClientProvider,{client:this.queryClient},p().createElement(o.UseSignal,{signal:this._tracker.currentChanged,initialSender:this._tracker,initialArgs:this._tracker.currentWidget},((e,t)=>{var s;return p().createElement(U,{key:null==t?void 0:t.id,model:null!==(s=null==t?void 0:t.content.model)&&void 0!==s?s:null})}))))}}var Q=s(1526);const Y=new Q.Token(`${y}:IProblemProviderRegistry`),z=new Q.Token(`${y}:IJudgePanelFactoryRegistry`),G=new Q.Token(`${y}:IJudgeSignal`),V=new k.Signal({}),X={id:`${y}:IJudgeSignal`,provides:G,activate:e=>({get submitted(){return V}}),autoStart:!0};let Z=new class{constructor(){this.problems={1:{id:"1",title:"덧셈",timeout:1,inputTransferType:"one_line",skeletonCode:null,content:"\n  # 덧셈\n  ## 문제\n  두 정수 A와 B를 입력받은 다음, A+B를 출력하는 프로그램을 작성하시오.\n  ## 입력\n  첫째 줄에 A와 B가 주어진다. (0 < A, B < 10)\n  ## 출력\n  첫째 줄에 A+B를 출력한다.\n          ",userId:null,testCases:["2 4","6 12","10000 21111","-1234 30"],outputs:["6","18","31111","-1204"]},2:{id:"2",title:"작은 별",timeout:1,inputTransferType:"one_line",skeletonCode:null,content:"\n  # 작은 별\n  ## 문제\n  정수 N을 입력받은 다음 다음과 같이 N줄의 별을 출력하는 프로그램을 작성하시오.\n  ## 입력\n  첫째 줄에 N이 주어진다. (0 < N < 10)\n  ## 출력\n  첫째 줄에는 별 1개, 둘째 줄에는 별 2개, ... N번째 줄에는 별 N개를 출력한다.\n          ",userId:null,testCases:["1","2","4","9"],outputs:["*","*\n**","*\n**\n***\n****","*\n**\n***\n****\n*****\n******\n*******\n********\n*********"]}},this._idToSubmissions={}}async getTestCases(e){return this.problems[e].testCases}async validate(e,t){const s=this.problems[e].outputs;if(s.length!==t.length)return{token:null,totalCount:s.length,acceptedCount:0};let n=0;for(let e=0;e<s.length;e++)s[e].trim()===t[e].trim()&&(n+=1);return{token:null,totalCount:s.length,acceptedCount:n}}async getProblem(e){return this.problems[e]}async getSubmissions(e){var t;return null!==(t=this._idToSubmissions[e])&&void 0!==t?t:[]}async submit(e){void 0===this._idToSubmissions[e.problemId]&&(this._idToSubmissions[e.problemId]=[]);const t=Object.assign(Object.assign({},e),{id:this._idToSubmissions[e.problemId].length.toString(),image:"",userId:"",createdAt:(new Date).toISOString()});return this._idToSubmissions[e.problemId].push(t),t}};const ee={id:`${y}:IProblemProviderRegistry`,provides:Y,activate:e=>({register:e=>{Z=e}}),autoStart:!0};let te=e=>new v(e);const se={id:`${y}:IJudgePanelFactoryRegistry`,provides:z,activate:e=>({register:e=>{te=e}}),autoStart:!0},ne=[{id:`${y}:plugin`,autoStart:!0,requires:[i.ITranslator,l.IEditorServices,u.IRenderMimeRegistry,A.IDocumentManager,F.IFileBrowserFactory,O.IPropertyInspectorProvider,N.IMainMenu],optional:[R.ISettingRegistry,n.ILayoutRestorer],activate:async(e,t,s,n,i,r,a,l,d,u)=>{const c=t.load(_),m=new o.WidgetTracker({namespace:"judge"}),h=c.__("Judge");let g=null;g=d?(await d.load("@jupyterlab/notebook-extension:tracker")).get("codeCellConfig").composite:{};const p=new S({editorServices:s,rendermime:n,commands:e.commands,editorConfig:g,judgePanelFactory:e=>te(e),submitted:V,factoryOptions:{name:h,modelName:"judge-model",fileTypes:["judge"],defaultFor:["judge"],preferKernel:!0,canStartKernel:!0,shutdownOnClose:!0,translator:t}}),w=new H({tracker:m,translator:t});w.id=`${y}-judge-tools`,w.title.caption="제출 기록",p.widgetCreated.connect(((e,t)=>{t.context.pathChanged.connect((()=>{m.save(t)})),m.add(t);const s=a.register(t);s.render(w),t.content.propertyInspector=s})),e.docRegistry.addWidgetFactory(p),e.docRegistry.addModelFactory(new T.JudgeModelFactory({problemProviderFactory:()=>Z})),e.docRegistry.addFileType({name:"judge",contentType:"file",fileFormat:"text",displayName:c.__("Judge File"),extensions:[".judge"],mimeTypes:["text/json","application/json"]}),function(e,t,s,n,o){e.addCommand(I.open,{execute:async e=>{s.openOrReveal(e.path)},label:t.__("Open Judge")}),e.addCommand(I.openOrCreateFromId,{execute:async e=>{e.problemId&&await async function(e,t,s){const n=await e.getProblem(s);if(n){const o=n.title,i=`${b}:${C}/[${s}]${o}.judge`,r=`${b}:${C}`;await t.services.contents.save(r,{name:r,type:"directory"}),await async function(e,t,s,n){try{await t.services.contents.get(s)}catch(o){throw o instanceof x.ServerConnection.ResponseError&&404===o.response.status&&await t.services.contents.save(s,{name:s,type:"file",format:"text",content:await T.newFileContent(e,n)}),o}finally{t.openOrReveal(s)}}(e,t,i,s)}}(o,s,e.problemId)},label:t.__("Open or Create Judge From Id")}),e.addCommand(I.execute,{execute:async e=>{n.currentWidget&&n.currentWidget.content.execute()},label:t.__("Execute")})}(e.commands,c,i,m,Z),function(e,t,s){!function(e,t){const s={tracker:t,undo:e=>{e.content.editor.undo()},redo:e=>{e.content.editor.redo()}};e.editMenu.undoers.add(s)}(e,t),function(e,t,s){const n={tracker:t,runLabel:e=>s.__("Run Code"),run:async e=>{await e.content.execute()},runAllLabel:e=>s.__("Run All Code"),runAll:async e=>{await e.content.execute()}};e.runMenu.codeRunners.add(n)}(e,t,s)}(l,m,c),u&&u.restore(m,{command:I.open,args:e=>({path:e.context.path}),name:e=>e.context.path}),e.serviceManager.contents.addDrive(new x.Drive({name:b})),r.createFileBrowser("judgebrowser",{driveName:b})}},ee,se,X]}}]);