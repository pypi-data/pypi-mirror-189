{% extends 'generic/object_list.html' %}
{% load buttons %}
{% load helpers %}
{% load render_table from django_tables2 %}
{% load static %}

{% comment %}
Blocks:
  extra_controls: Additional action buttons
  bulk_buttons: Additional bulk action buttons to display beneath the objects
    list

Context:
  model: The model class being listed
  table: The table class used for rendering the list of objects
  actions: A list of buttons to display. This template checks for add, import,
    export, bulk_edit, and bulk_delete.
  filter_form: The bound filterset form for filtering the objects list (optional)
  return_url: Return URL to use for bulk actions (optional)
{% endcomment %}


{% block content-wrapper %}
<div class="tab-content">
  {# Object list #}
  <div class="tab-pane show active" id="object-list" role="tabpanel" aria-labelledby="object-list-tab">

    {# Applied filters #}
    {% if filter_form %}
      {% applied_filters model filter_form request.GET %}
    {% endif %}

    {# "Select all" form #}
    {% if table.paginator.num_pages > 1 %}
      <div id="select-all-box" class="d-none card noprint">
        <form method="post" class="form col-md-12">
          {% csrf_token %}
          <div class="card-body">
            <div class="float-end">
              {% if 'bulk_edit' in actions %}
                {% bulk_edit_button model query_params=request.GET %}
              {% endif %}
              {% if 'bulk_delete' in actions %}
                {% bulk_delete_button model query_params=request.GET %}
              {% endif %}
            </div>
            <div class="form-check">
              <input type="checkbox" id="select-all" name="_all" class="form-check-input" />
              <label for="select-all" class="form-check-label">
                Select <strong>all {{ table.rows|length }} {{ table.data.verbose_name_plural }}</strong> matching query
              </label>
            </div>
          </div>
        </form>
      </div>
    {% endif %}

    {# Object table controls #}
    {% include 'netos_inventory/inc/table_controls_htmx.html' with table_modal="ObjectTable_config" %}

    <form method="post" class="form form-horizontal">
      {% csrf_token %}
      <input type="hidden" name="return_url" value="{% if return_url %}{{ return_url }}{% else %}{{ request.path }}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}{% endif %}" />

      {# Object table #}

          {% if prerequisite_model %}
            {% include 'inc/missing_prerequisites.html' %}
          {% endif %}

      <div class="card">
        <div class="card-body" id="object_list">
          {% include 'htmx/table.html' %}
        </div>
      </div>

      {# Form buttons #}
      <div class="noprint bulk-buttons">
        <div class="bulk-button-group">
          {% block bulk_buttons %}
            {% if 'bulk_edit' in actions %}
              {% bulk_edit_button model query_params=request.GET %}
            {% endif %}
            {% if 'bulk_delete' in actions %}
              {% bulk_delete_button model query_params=request.GET %}
            {% endif %}
          {% endblock %}
        </div>
      </div>

    </form>

  </div>

  {# Filter form #}
  {% if filter_form %}
    <div class="tab-pane show" id="filters-form" role="tabpanel" aria-labelledby="filters-form-tab">
      {% include 'inc/filter_list.html' %}
    </div>
  {% endif %}
  {# Summary #}
  <div class="tab-pane show" id="object-summary" role="tabpanel" aria-labelledby="object-summary-tab">
    <ul id="site-data" class="visually-hidden">
      {% for model_name, polled_count in last_polled.items %}
      <li>{{ model_name }};{{ polled_count }}</li>
      {% endfor %}
  </ul>
    <h2 class="mt-4">Last Polled&nbsp;<i title="Count number of models which were polled after number of weeks on X axis" class="mdi mdi-information-outline text-primary fs-3" data-bs-placement="right" data-bs-toggle="tooltip"></i></h2>
    <div id="site-chart-list" class="row"></div>
  </div>
</div>
{% endblock content-wrapper %}


{% block tabs %}
  <ul class="nav nav-tabs px-3">
    <li class="nav-item" role="presentation">
      <button class="nav-link show" id="object-summary-tab" data-bs-toggle="tab" data-bs-target="#object-summary" type="button" role="tab" aria-controls="edit-form" aria-selected="true">
        Summary
      </button>
    </li>
    {% with tab_name='device-detected' %}
            <li role="presentation" class="nav-item">
                <a class="nav-link {% if active_tab == tab_name %} active{% endif %}" href="{% url 'plugins:netos_inventory:devicedetected_list' %}">Device Detected</a>
            </li>
    {% endwith %}
    {% with tab_name='interface-detected' %}
            <li role="presentation" class="nav-item">
                <a class="nav-link {% if active_tab == tab_name %} active{% endif %}" href="{% url 'plugins:netos_inventory:interfacedetected_list' %}">Interface Detected</a>
            </li>
    {% endwith %}
    {% with tab_name='module-detected' %}
            <li role="presentation" class="nav-item">
                <a class="nav-link {% if active_tab == tab_name %} active{% endif %}" href="{% url 'plugins:netos_inventory:moduledetected_list' %}">Module Detected</a>
            </li>
    {% endwith %}
    {% with tab_name='cable-detected' %}
            <li role="presentation" class="nav-item">
                <a class="nav-link {% if active_tab == tab_name %} active{% endif %}" href="{% url 'plugins:netos_inventory:cabledetected_list' %}">Cable Detected</a>
            </li>
    {% endwith %}
    {% if filter_form %}
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="filters-form-tab" data-bs-toggle="tab" data-bs-target="#filters-form" type="button" role="tab" aria-controls="object-list" aria-selected="false">
          Filters
          {% if filter_form %}{% badge filter_form.changed_data|length bg_color="primary" %}{% endif %}
        </button>
      </li>
    {% endif %}
  </ul>
{% endblock tabs %}

{% block javascript %}
<script src="{% static 'netos_inventory/js/last_detected.js' %}?version=0.1.20"></script>
{% endblock javascript %}
