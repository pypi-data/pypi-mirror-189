[{"apiVersion":"influxdata.com/v2alpha1","kind":"Task","metadata":{"name":"exciting-varahamihira-5b7001"},"spec":{"every":"5m","name":"aggregate_vmppt","query":"import \"influxdata/influxdb/tasks\"\n\n\n\nrawwindow =\n    from(bucket: \"raw\")\n        |> range(start: tasks.lastSuccess(orTime: -1h))\n        |> filter(fn: (r) => r[\"_measurement\"] =~ /ina226_*/)\n\naggmean =\n    rawwindow\n        |> filter(fn: (r) => r[\"_field\"] == \"batteryVoltage\" or r[\"_field\"] == \"batteryCurrent\")\n        |> aggregateWindow(every: 5m, fn: mean, createEmpty: false)\n\nagglast =\n    rawwindow\n        |> filter(\n            fn: (r) =>\n                r[\"_field\"] == \"yieldToday\" or r[\"_field\"] == \"yieldYesterday\" or r[\"_field\"]\n                    ==\n                    \"maximumPowerToday\" or r[\"_field\"] == \"maximumPowerYesterday\" or r[\"_field\"]\n                    ==\n                    \"mode\" or r[\"_field\"] == \"trackerMode\",\n        )\n        |> aggregateWindow(every: 5m, fn: last, createEmpty: false)\n\nunion(tables: [aggmean, agglast])\n    |> to(bucket: \"aggregated\")"}}]