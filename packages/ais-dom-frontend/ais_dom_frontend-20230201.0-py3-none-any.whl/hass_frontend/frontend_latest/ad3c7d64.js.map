{"version":3,"file":"ad3c7d64.js","mappings":";;;;;;;;;;;;;;;;;;;;AA6CA;ACkBA;;AAIA;AACA;AACA;;;;AAIA;AACA;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACkFA;;AAoEA;;AAGA;;AA0CA;;;;AAIA;AACA;;AAAA;;;;;;;;;;;AAYA;AACA;;;;;;;;;;;;AAYA;AACA;;;;;;;;;;;;;;AAcA;AACA;;;;;;;;;;;;;;;;;;;;;AAqBA;;;;;;;;;;;;;;;AAgBA;;;AAIA;;;;;;;;;;;;;;;AAgBA;;;AAIA;;;;;;;AAQA;AACA;;AAEA;AAKA;AACA;;;;;AAMA;;AAGA;;;;;;;AAUA;AACA;;;;;;;;;AASA;AACA;;;;;;;;;;;;AAYA;AACA;;;;;;;;;;;;AAYA;AACA;;;;;;;;AAQA;;;;AAKA;;;;;AAKA;AACA;;;;;;AAMA;;;;;;;AAOA;AACA;;;;;;;AAOA;;;;;;;;;AAaA;AACA;;;;;;;;;;;AAWA;;;;AAQA;;;;;;;AAOA;;;AAGA;;;;;;AAMA;;;;;AAKA;;;;;;;;;;;;;;;AAiBA;AACA;;;;;AAKA;AACA;;;;;;;;;;;;;;;;;;;;;;AAsBA;AACA;;;;;AAKA;AACA;;AAEA;AAKA;;;;;AAMA;;;;;AAMA;AACA;;;;;;;;;;;;;;;;;AAkBA;;;;AAMA;;;;;;AAOA","sources":["webpack://home-assistant-frontend/./src/components/ha-switch.ts","webpack://home-assistant-frontend/./src/components/ha-yaml-editor.ts","webpack://home-assistant-frontend/./src/panels/config/ais_dom/ha-config-ais-dom-config-logs.ts"],"sourcesContent":["import { SwitchBase } from \"@material/mwc-switch/deprecated/mwc-switch-base\";\nimport { styles } from \"@material/mwc-switch/deprecated/mwc-switch.css\";\nimport { css } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport { forwardHaptic } from \"../data/haptics\";\n\n@customElement(\"ha-switch\")\nexport class HaSwitch extends SwitchBase {\n  // Generate a haptic vibration.\n  // Only set to true if the new value of the switch is applied right away when toggling.\n  // Do not add haptic when a user is required to press save.\n  @property({ type: Boolean }) public haptic = false;\n\n  protected firstUpdated() {\n    super.firstUpdated();\n    this.addEventListener(\"change\", () => {\n      if (this.haptic) {\n        forwardHaptic(\"light\");\n      }\n    });\n  }\n\n  static override styles = [\n    styles,\n    css`\n      :host {\n        --mdc-theme-secondary: var(--switch-checked-color);\n      }\n      .mdc-switch.mdc-switch--checked .mdc-switch__thumb {\n        background-color: var(--switch-checked-button-color);\n        border-color: var(--switch-checked-button-color);\n      }\n      .mdc-switch.mdc-switch--checked .mdc-switch__track {\n        background-color: var(--switch-checked-track-color);\n        border-color: var(--switch-checked-track-color);\n      }\n      .mdc-switch:not(.mdc-switch--checked) .mdc-switch__thumb {\n        background-color: var(--switch-unchecked-button-color);\n        border-color: var(--switch-unchecked-button-color);\n      }\n      .mdc-switch:not(.mdc-switch--checked) .mdc-switch__track {\n        background-color: var(--switch-unchecked-track-color);\n        border-color: var(--switch-unchecked-track-color);\n      }\n    `,\n  ];\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-switch\": HaSwitch;\n  }\n}\n","import { DEFAULT_SCHEMA, dump, load, Schema } from \"js-yaml\";\nimport { html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport type { HomeAssistant } from \"../types\";\nimport \"./ha-code-editor\";\n\nconst isEmpty = (obj: Record<string, unknown>): boolean => {\n  if (typeof obj !== \"object\") {\n    return false;\n  }\n  for (const key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      return false;\n    }\n  }\n  return true;\n};\n\n@customElement(\"ha-yaml-editor\")\nexport class HaYamlEditor extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public value?: any;\n\n  @property({ attribute: false }) public yamlSchema: Schema = DEFAULT_SCHEMA;\n\n  @property() public defaultValue?: any;\n\n  @property() public isValid = true;\n\n  @property() public label?: string;\n\n  @property({ type: Boolean }) public readOnly = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  @state() private _yaml = \"\";\n\n  public setValue(value): void {\n    try {\n      this._yaml =\n        value && !isEmpty(value)\n          ? dump(value, { schema: this.yamlSchema, quotingType: '\"' })\n          : \"\";\n    } catch (err: any) {\n      // eslint-disable-next-line no-console\n      console.error(err, value);\n      alert(`There was an error converting to YAML: ${err}`);\n    }\n  }\n\n  protected firstUpdated(): void {\n    if (this.defaultValue) {\n      this.setValue(this.defaultValue);\n    }\n  }\n\n  protected render(): TemplateResult {\n    if (this._yaml === undefined) {\n      return html``;\n    }\n    return html`\n      ${this.label\n        ? html`<p>${this.label}${this.required ? \" *\" : \"\"}</p>`\n        : \"\"}\n      <ha-code-editor\n        .hass=${this.hass}\n        .value=${this._yaml}\n        .readOnly=${this.readOnly}\n        mode=\"yaml\"\n        autocomplete-entities\n        autocomplete-icons\n        .error=${this.isValid === false}\n        @value-changed=${this._onChange}\n        dir=\"ltr\"\n      ></ha-code-editor>\n    `;\n  }\n\n  private _onChange(ev: CustomEvent): void {\n    ev.stopPropagation();\n    this._yaml = ev.detail.value;\n    let parsed;\n    let isValid = true;\n\n    if (this._yaml) {\n      try {\n        parsed = load(this._yaml, { schema: this.yamlSchema });\n      } catch (err: any) {\n        // Invalid YAML\n        isValid = false;\n      }\n    } else {\n      parsed = {};\n    }\n\n    this.value = parsed;\n    this.isValid = isValid;\n\n    fireEvent(this, \"value-changed\", { value: parsed, isValid } as any);\n  }\n\n  get yaml() {\n    return this._yaml;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-yaml-editor\": HaYamlEditor;\n  }\n}\n","import \"../../../components/ha-yaml-editor\";\nimport \"../../../components/ha-code-editor\";\nimport \"../../../components/ha-expansion-panel\";\nimport \"@polymer/app-layout/app-header/app-header\";\nimport \"@polymer/app-layout/app-toolbar/app-toolbar\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  PropertyValues,\n  TemplateResult,\n} from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport { dump, load } from \"js-yaml\";\nimport { HomeAssistant } from \"../../../types\";\nimport \"../../../layouts/hass-subpage\";\nimport \"../../../resources/ha-style\";\nimport \"./ha-config-ais-dom-dashboard\";\nimport \"../../../components/ha-switch\";\nimport \"@material/mwc-select\";\nimport \"@material/mwc-list/mwc-list-item\";\nimport \"../../../components/buttons/ha-call-service-button\";\nimport \"../../../components/ha-icon\";\nimport \"../../../components/ha-circular-progress\";\nimport { handleFetchPromise } from \"../../../util/hass-call-api\";\nimport { haStyle } from \"../../../resources/styles\";\n\nexport interface aisSaveDbSettingsResponse {\n  info: string;\n  error: string;\n}\n\nexport const aisSaveDbSettings = (params: {\n  dbEngine: string;\n  dbDrive: string;\n  dbUser: string;\n  dbPassword: string;\n  dbServerIp: string;\n  dbServerName: string;\n  dbKeepDays: number;\n  dbShowLogbook: boolean;\n  dbShowHistory: boolean;\n  dbInclude: any;\n  dbExclude: any;\n}) =>\n  handleFetchPromise<aisSaveDbSettingsResponse>(\n    fetch(\"/api/ais_file/ais_db_view\", {\n      method: \"POST\",\n      credentials: \"same-origin\",\n      body: JSON.stringify(params),\n    })\n  );\n\n@customElement(\"ha-config-ais-dom-config-logs\")\nclass HaConfigAisDomConfiglLogs extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public isWide?: boolean;\n\n  @property({ type: String }) private logLevel = \"\";\n\n  @property({ type: String }) private logDrive = \"\";\n\n  @property({ type: Number }) private logRotating = 1;\n\n  @property({ type: Boolean }) private dbConnectionValidating = false;\n\n  @property({ type: String }) private logModeInfo = \"\";\n\n  @property({ type: String }) private dbDrive = \"\";\n\n  @property({ type: String }) private dbEngine = \"\";\n\n  @property({ type: String }) private dbUser = \"\";\n\n  @property({ type: String }) private dbPassword = \"\";\n\n  @property({ type: String }) private dbServerIp = \"\";\n\n  @property({ type: String }) private dbServerName = \"\";\n\n  @property({ type: Number }) private dbKeepDays = 10;\n\n  @property({ type: String }) private errorDbInfo = \"\";\n\n  @property({ type: String }) private messageDbInfo = \"\";\n\n  @property({ type: Boolean }) private dbShowLogbook = false;\n\n  @property({ type: Boolean }) private dbShowHistory = false;\n\n  @property() private dbInclude = \"\";\n\n  @property() private dbExclude = \"\";\n\n  static get styles(): CSSResultGroup[] {\n    return [\n      haStyle,\n      css`\n        .content {\n          padding-bottom: 32px;\n        }\n\n        .border {\n          margin: 32px auto 0;\n          border-bottom: 1px solid rgba(0, 0, 0, 0.12);\n          max-width: 1040px;\n        }\n        .narrow .border {\n          max-width: 640px;\n        }\n        .card-actions {\n          display: flex;\n        }\n        ha-card > div#card-icon {\n          margin: -4px 0;\n          position: absolute;\n          top: 1em;\n          right: 1em;\n          border-radius: 25px;\n        }\n        .center-container {\n          text-align: center;\n          height: 70px;\n        }\n\n        .config-invalid {\n          color: red;\n          text-align: center;\n          padding-bottom: 1em;\n        }\n        .config-valid {\n          color: green;\n          text-align: center;\n          padding-bottom: 1em;\n        }\n        .inportant-info {\n          color: var(--primary-color);\n          font-weight: bold;\n        }\n\n        @keyframes pulse {\n          0% {\n            background-color: var(--card-background-color);\n          }\n          100% {\n            background-color: orange;\n          }\n        }\n        @keyframes pulseRed {\n          0% {\n            background-color: var(--card-background-color);\n          }\n          100% {\n            background-color: red;\n          }\n        }\n      `,\n    ];\n  }\n\n  private getLogError(logSettingsInfo) {\n    let logError = \"\";\n    if (logSettingsInfo.attributes.errorInfo) {\n      logError = logSettingsInfo.attributes.errorInfo + \" \";\n    }\n    if (this.logLevel === \"debug\") {\n      logError +=\n        \"Logowanie w trybie debug generuje duże ilości logów i obciąża system. Używaj go tylko podczas diagnozowania problemu. \";\n    }\n    return logError;\n  }\n\n  private isNotSeleced(option) {\n    if (!option) {\n      return true;\n    }\n    if (option === \"-\") {\n      return true;\n    }\n    if (option === \"\") {\n      return true;\n    }\n\n    return false;\n  }\n\n  private getLogIconAnimationStyle(_logSettingsInfo) {\n    if (!this.isNotSeleced(this.logDrive)) {\n      if (this.logLevel === \"debug\") {\n        return \"animation: pulseRed 2s infinite;\";\n      }\n      if (this.logLevel === \"info\") {\n        return \"animation: pulse 4s infinite;\";\n      }\n      if (this.logLevel === \"warning\") {\n        return \"animation: pulse 7s infinite;\";\n      }\n      if (this.logLevel === \"error\") {\n        return \"animation: pulse 8s infinite;\";\n      }\n      if (this.logLevel === \"critical\") {\n        return \"animation: pulse 10s infinite;\";\n      }\n    }\n    return \"\";\n  }\n\n  // DB recorder\n\n  private getDbStatusIcon(dbEngine) {\n    // memory \"animation: pulse 6s infinite;\";\n    if (this.isNotSeleced(dbEngine)) {\n      return html``;\n    }\n    let dbIcon = \"mdi:database\";\n    if (dbEngine === \"SQLite (memory)\") {\n      dbIcon = \"mdi:memory\";\n    }\n    if (dbEngine === \"SQLite (file)\") {\n      dbIcon = \"mdi:file\";\n    }\n    if (dbEngine === \"PostgreSQL\") {\n      dbIcon = \"mdi:server\";\n    }\n    return html`\n      <div id=\"card-icon\" style=\"animation: pulse 6s infinite;\">\n        <ha-icon icon=${dbIcon}></ha-icon>\n      </div>\n    `;\n  }\n\n  private _getDbConnectionSettings() {\n    // DB\n    const dbConnectionInfo = this.hass.states[\"sensor.ais_db_connection_info\"];\n    const dbConnInfoAttr = dbConnectionInfo.attributes;\n    this.dbEngine = dbConnInfoAttr.dbEngine;\n    this.dbDrive = dbConnInfoAttr.dbDrive;\n    this.dbPassword = dbConnInfoAttr.dbPassword;\n    this.dbUser = dbConnInfoAttr.dbUser;\n    this.dbServerIp = dbConnInfoAttr.dbServerIp;\n    this.dbServerName = dbConnInfoAttr.dbServerName;\n    this.dbKeepDays = dbConnInfoAttr.dbKeepDays;\n    this.errorDbInfo = \"\";\n    this.messageDbInfo = \"\";\n    this.dbShowLogbook = dbConnInfoAttr.dbShowLogbook;\n    this.dbShowHistory = dbConnInfoAttr.dbShowHistory;\n    this.dbInclude = dump(dbConnInfoAttr.dbInclude || \"\").trimRight();\n    this.dbExclude = dump(dbConnInfoAttr.dbExclude || \"\").trimRight();\n  }\n\n  private _getLogSettings() {\n    // LOG\n    const connectionInfo = this.hass.states[\"sensor.ais_logs_settings_info\"];\n    const connInfoAttr = connectionInfo.attributes;\n    this.logDrive = connInfoAttr.logDrive;\n    this.logLevel = connInfoAttr.logLevel;\n    this.logRotating = connInfoAttr.logRotating;\n  }\n\n  protected firstUpdated(changedProps: PropertyValues): void {\n    super.firstUpdated(changedProps);\n    // DB\n    this._getDbConnectionSettings();\n\n    // LOG\n    this._getLogSettings();\n  }\n\n  protected render(): TemplateResult {\n    return html`\n      <hass-subpage header=\"Konfiguracja bramki AIS dom\">\n        <ha-config-section .is-wide=${this.isWide}>\n          <span slot=\"header\">Konfiguracja zapisu zdarzeń systemu</span>\n          <ha-card header=\"Baza danych do zapisu zdarzeń\">\n            <!-- show db satus  -->\n            ${this.getDbStatusIcon(this.dbEngine)}\n            ${!this.dbConnectionValidating\n              ? html`\n                  <div class=\"card-content\">\n                    Najprostszy wybór to baza SQLite, która nie wymaga\n                    konfiguracji i może rejestrować dane w pamięci.\n                    <b>Zmiany konfiguracji bazy wymagają restartu systemu.</b>\n                    Baza w pamięci jest automatycznie używana, gdy włączysz\n                    komponent Historia lub Dziennik.\n                    <br />\n                    <br />\n                    <ha-icon icon=\"hass:chart-box\" slot=\"suffix\"></ha-icon>\n                    <ha-switch\n                      .checked=${this.dbShowHistory}\n                      @change=${this.dbShowHistoryChanged}\n                    ></ha-switch>\n                    Historia - prezentowanie zdarzeń zapisanych w bazie na\n                    wykresach w aplikacji\n                    <br />\n                    <br />\n\n                    <ha-icon\n                      icon=\"hass:format-list-bulleted-type\"\n                      slot=\"suffix\"\n                    ></ha-icon>\n                    <ha-switch\n                      .checked=${this.dbShowLogbook}\n                      @change=${this.dbShowLogbookChanged}\n                    ></ha-switch>\n                    Dziennik - prezentowanie zmian zapisanych w bazie w\n                    chronologicznej kolejności\n\n                    <br /><br />\n\n                    Wybór silnika bazy danych:\n                    <br />\n                    <ha-icon icon=\"mdi:database\"></ha-icon>\n\n                    <mwc-select\n                      label-float=\"Silnik bazy danych\"\n                      label=\"Silnik bazy danych\"\n                      .value=${this.dbEngine}\n                      @selected=${this.dbEngineChanged}\n                    >\n                      <mwc-list-item value=\"-\">-</mwc-list-item>\n                      <mwc-list-item value=\"SQLite (memory)\"\n                        >SQLite (memory)</mwc-list-item\n                      >\n                      <mwc-list-item value=\"SQLite (file)\"\n                        >SQLite (file)</mwc-list-item\n                      >\n                      <mwc-list-item value=\"PostgreSQL (local)\"\n                        >PostgreSQL (local)</mwc-list-item\n                      >\n                      <mwc-list-item value=\"MariaDB\">MariaDB</mwc-list-item>\n                      <mwc-list-item value=\"MySQL\">MySQL</mwc-list-item>\n                      <mwc-list-item value=\"PostgreSQL\"\n                        >PostgreSQL</mwc-list-item\n                      >\n                    </mwc-select>\n                  </div>\n\n                  <!-- MEMORY -->\n                  ${this.dbEngine === \"SQLite (memory)\"\n                    ? html`\n                        <div class=\"card-content\">\n                          Żeby utrzymać system w dobrej kondycji, codziennie\n                          dokładnie o godzinie 5:15 rano, Asystent czyści pamięć\n                          i usuwa zdarzenia i stany starsze niż <b>5 dni</b>.\n                          <br /><br />\n                          <span class=\"inportant-info\">\n                            Jeżeli zacznie brakować pamięci w systemie, to\n                            automatycznie wyczyścimy całą historię bazy, żeby\n                            zwolnić miejsce.\n                          </span>\n                          <br /><br />\n                          Gdy chcesz zapisywać większą ilość dni w historii, to\n                          zalecamy zapisywać zdarzenia w zdalnej bazie danych.\n                        </div>\n                      `\n                    : html``}\n\n                  <!-- PostgreSQL (local) -->\n                  ${this.dbEngine === \"PostgreSQL (local)\"\n                    ? html`\n                        <div class=\"card-content\">\n                          Żeby utrzymać system w dobrej kondycji, codziennie\n                          dokładnie o godzinie 5:15 rano, Asystent czyści\n                          lokalną bazę i usuwa zdarzenia i stany starsze niż\n                          <b>10 dni</b>. <br /><br />\n                          <span class=\"inportant-info\">\n                            Jeżeli zacznie brakować miejsca na dysku w systemie,\n                            to automatycznie wyczyścimy całą historię lokalnej\n                            bazy, żeby zwolnić miejsce.\n                          </span>\n                          <br /><br />\n                          Gdy chcesz zapisywać większą ilość dni w historii, to\n                          zalecamy zapisywać zdarzenia w zdalnej bazie danych.\n                        </div>\n                      `\n                    : html``}\n\n                  <!-- FILE -->\n                  ${this.dbEngine === \"SQLite (file)\"\n                    ? html`\n                        <div class=\"card-content\">\n                          Wybór dysku do zapisu bazy danych: <br />\n                          <ha-icon icon=\"mdi:usb-flash-drive\"></ha-icon>\n                          <mwc-select\n                            label-float=\"Dysk wymienny\"\n                            label=\"Dysk wymienny\"\n                            .value=${this.dbDrive}\n                            @selected=${this.dbDriveChanged}\n                          >\n                            ${this.hass.states[\n                              \"input_select.ais_usb_flash_drives\"\n                            ].attributes.options!.map(\n                              (item: string) =>\n                                html`\n                                  <mwc-list-item .value=${item}>\n                                    ${item}\n                                  </mwc-list-item>\n                                `\n                            )} </mwc-select\n                          >> <br /><br />\n                        </div>\n                      `\n                    : html``}\n                  <!-- DB -->\n                  ${this.dbEngine === \"MariaDB\" ||\n                  this.dbEngine === \"MySQL\" ||\n                  this.dbEngine === \"PostgreSQL\"\n                    ? html`\n                        <div class=\"card-content\">\n                          Parametry połączenia z bazą danych: <br />\n                          <paper-input\n                            placeholder=\"Użytkownik\"\n                            type=\"text\"\n                            id=\"db_user\"\n                            value=${this.dbUser}\n                            @value-changed=${this.dbUserChanged}\n                          >\n                            <ha-icon icon=\"mdi:account\" slot=\"suffix\"></ha-icon>\n                          </paper-input>\n                          <paper-input\n                            placeholder=\"Hasło\"\n                            no-label-float=\"\"\n                            type=\"password\"\n                            id=\"db_password\"\n                            .value=${this.dbPassword}\n                            @value-changed=${this.dbPasswordChanged}\n                          >\n                            <ha-icon\n                              icon=\"mdi:lastpass\"\n                              slot=\"suffix\"\n                            ></ha-icon>\n                          </paper-input>\n                          <paper-input\n                            placeholder=\"IP Serwera DB\"\n                            no-label-float=\"\"\n                            type=\"text\"\n                            id=\"db_server_ip\"\n                            value=${this.dbServerIp}\n                            @value-changed=${this.dbServerIpChanged}\n                          >\n                            <ha-icon\n                              icon=\"mdi:ip-network\"\n                              slot=\"suffix\"\n                            ></ha-icon>\n                          </paper-input>\n                          <paper-input\n                            placeholder=\"Nazwa bazy\"\n                            no-label-float=\"\"\n                            type=\"text\"\n                            id=\"db_server_name\"\n                            value=${this.dbServerName}\n                            @value-changed=${this.dbServerNameChanged}\n                          >\n                            <ha-icon\n                              icon=\"mdi:database-check\"\n                              slot=\"suffix\"\n                            ></ha-icon>\n                          </paper-input>\n                        </div>\n                      `\n                    : html``}\n                  <div class=\"card-content\">\n                    <h1>Filtrowanie zapisu zdarzeń</h1>\n                    <ha-expansion-panel\n                      .header=${html`<ha-icon icon=\"mdi:filter-plus\"></ha-icon>\n                        &nbsp;Wybrane do zapisywania:`}\n                    >\n                      <ha-code-editor\n                        mode=\"yaml\"\n                        .value=${this.dbInclude}\n                        @value-changed=${this.dbIncludeChanged}\n                      >\n                      </ha-code-editor>\n                    </ha-expansion-panel>\n\n                    <ha-expansion-panel\n                      .header=${html`<ha-icon\n                          icon=\"mdi:filter-remove\"\n                        ></ha-icon>\n                        &nbsp;Wykluczone z zapisywania:`}\n                    >\n                      <ha-code-editor\n                        mode=\"yaml\"\n                        .value=${this.dbExclude}\n                        @value-changed=${this.dbExcludeChanged}\n                      >\n                      </ha-code-editor>\n                    </ha-expansion-panel>\n                  </div>\n\n                  <!-- KEEP DAYS -->\n                  ${this.dbEngine === \"SQLite (file)\" ||\n                  this.dbEngine === \"MariaDB\" ||\n                  this.dbEngine === \"MySQL\" ||\n                  this.dbEngine === \"PostgreSQL\"\n                    ? html`\n                  <div class=\"card-content\">\n                    Żeby utrzymać system w dobrej kondycji, codziennie dokładnie o godzinie 5:15 rano Asystent usuwa z bazy zdarzenia i stany starsze niż <b>określona liczba dni</b>.\n                    <br /><br />\n                    W tym miejscu możesz określić liczbę dni, których historia ma być\n                    przechowywana w bazie danych.\n                    <paper-input\n                      id=\"db_keep_days\"\n                      type=\"number\"\n                      value=${this.dbKeepDays}\n                      @value-changed=${this.dbKeepDaysChanged}\n                      maxlength=\"4\"\n                      max=\"9999\"\n                      min=\"1\"\n                      label-float=\"Liczba dni historii przechowywanych w bazie\"\n                      label=\"Liczba dni historii przechowywanych w bazie\"\n                    >\n                      <ha-icon icon=\"mdi:calendar\" slot=\"suffix\"></ha-icon>\n                    </paper-input>\n                  </div>\n                </div>\n                `\n                    : html``}\n                `\n              : html`<div style=\"width: 100%; text-align: center;\">\n                  <ha-circular-progress active></ha-circular-progress>\n                </div>`}\n\n            <div class=\"center-container\">\n              <mwc-button @click=\"${this.saveDbSettings}\">\n                Sprawdź i zapisz\n              </mwc-button>\n            </div>\n\n            <div class=\"center-content\">\n              <div class=\"config-invalid\">\n                <span class=\"text\"> ${this.errorDbInfo} </span>\n              </div>\n              <div class=\"config-valid\">\n                <span class=\"text\"> ${this.messageDbInfo} </span>\n              </div>\n            </div>\n          </ha-card>\n        </ha-config-section>\n\n        <ha-config-section .is-wide=${this.isWide}>\n          <span slot=\"header\">Ustawienie zapisu logów systemu</span>\n          <ha-card header=\" Wybór parametrów logowania\">\n            <div\n              id=\"card-icon\"\n              .style=${this.getLogIconAnimationStyle(\n                this.hass.states[\"sensor.ais_logs_settings_info\"]\n              )}\n            >\n              <ha-icon icon=\"mdi:content-save-edit\"></ha-icon>\n            </div>\n            <div class=\"card-content\">\n              <ha-icon icon=\"mdi:bug-check\"></ha-icon>\n\n              <!-- <ha-paper-dropdown-menu\n                label-float=\"Poziom logowania\"\n                dynamic-align=\"\"\n                label=\"Poziomy logowania\"\n              >\n                <paper-listbox\n                  slot=\"dropdown-content\"\n                  attr-for-selected=\"item-name\"\n                  .selected=${this.logLevel}\n                  @iron-select=${this.logLevelChanged}\n                > -->\n              <mwc-select\n                label-float=\"Poziomy logowania\"\n                label=\"Poziomy logowania\"\n                .value=${this.logLevel}\n                @selected=${this.logLevelChanged}\n              >\n                <mwc-list-item value=\"critical\">critical</mwc-list-item>\n                <mwc-list-item value=\"error\">error</mwc-list-item>\n                <mwc-list-item value=\"warning\">warning</mwc-list-item>\n                <mwc-list-item value=\"info\">info</mwc-list-item>\n                <mwc-list-item value=\"debug\">debug</mwc-list-item>\n              </mwc-select>\n              <br />\n\n              Jeśli chcesz zapisywać logi trwale do pliku, wybierz dysk wymienny\n              (USB, SD card) na którym będą zapisywane logi: <br />\n              <ha-icon icon=\"mdi:usb-flash-drive\"></ha-icon>\n\n              <!-- <ha-paper-dropdown-menu\n                label-float=\"Wybrany dysk\"\n                dynamic-align=\"\"\n                label=\"Dyski wymienne\"\n              >\n                <paper-listbox\n                  slot=\"dropdown-content\"\n                  attr-for-selected=\"item-name\"\n                  .selected=${this.logDrive}\n                  @iron-select=${this.logDriveChanged}\n                > -->\n              <mwc-select\n                label-float=\"Dysk wymienny\"\n                label=\"Dysk wymienny\"\n                .value=${this.logDrive}\n                @selected=${this.logDriveChanged}\n              >\n                ${this.hass.states[\n                  \"input_select.ais_usb_flash_drives\"\n                ].attributes.options!.map(\n                  (item: string) =>\n                    html`\n                      <mwc-list-item .value=${item}> ${item}</mwc-list-item>\n                    `\n                )}\n              </mwc-select>\n\n              <br /><br />\n              ${!this.isNotSeleced(this.logDrive)\n                ? html`\n                    Możesz określić liczbę dni przechowywanych w jednym pliku.\n                    Rotacja plików dziennika wykonywna jest o północy.\n                    <paper-input\n                      type=\"number\"\n                      .value=${this.logRotating}\n                      @change=${this.logRotatingDaysChanged}\n                      maxlength=\"4\"\n                      max=\"9999\"\n                      min=\"1\"\n                      label-float=\"Liczba dni przechowywanych w jednym pliku loga\"\n                      label=\"Liczba dni przechowywanych w jednym pliku loga\"\n                    >\n                      <ha-icon icon=\"mdi:calendar\" slot=\"suffix\"></ha-icon>\n                    </paper-input>\n                    Zmiana dysku lub zmiana liczby dni przechowywanych będzie\n                    zralizowana po restartcie systemu.\n                  `\n                : html``}\n            </div>\n\n            <div class=\"card-content\">\n              <div class=\"config-invalid\">\n                <span class=\"text\">\n                  ${this.getLogError(\n                    this.hass.states[\"sensor.ais_logs_settings_info\"]\n                  )}\n                </span>\n              </div>\n            </div>\n            <div class=\"card-content\">${this.logModeInfo}</div>\n          </ha-card>\n        </ha-config-section>\n        <br />\n        <br />\n      </hass-subpage>\n    `;\n  }\n\n  private saveLoggerSettings() {\n    this.hass.callService(\"ais_files\", \"change_logger_settings\", {\n      log_drive: this.logDrive,\n      log_level: this.logLevel,\n      log_rotating: this.logRotating,\n    });\n  }\n\n  private logDriveChanged(ev) {\n    const newValue = ev.target!.selected.value;\n    if (newValue !== this.logDrive) {\n      this.logDrive = newValue;\n      if (!this.isNotSeleced(this.logDrive)) {\n        this.logModeInfo =\n          \"Zapis logów do pliku /dyski-wymienne/\" + this.logDrive + \"/ais.log\";\n      } else {\n        this.logModeInfo = \"Zapis logów do pliku wyłączony \";\n      }\n      this.saveLoggerSettings();\n    }\n  }\n\n  private logLevelChanged(ev) {\n    const newValue = ev.target!.selected.value;\n    if (newValue !== this.logLevel) {\n      this.logLevel = newValue;\n      this.logModeInfo = \"Poziom logowania: \" + this.logLevel;\n      this.saveLoggerSettings();\n    }\n  }\n\n  private logRotatingDaysChanged(ev) {\n    const newValue = Number(ev.target.value);\n    if (this.logRotating !== newValue) {\n      this.logRotating = newValue;\n      if (this.logRotating === 1) {\n        this.logModeInfo = \"Rotacja logów codziennie.\";\n      } else {\n        this.logModeInfo = \"Rotacja logów co \" + this.logRotating + \" dni.\";\n      }\n      this.saveLoggerSettings();\n    }\n  }\n\n  private async saveDbSettings(): Promise<void> {\n    this.dbConnectionValidating = true;\n    try {\n      const result = await aisSaveDbSettings({\n        dbEngine: this.dbEngine,\n        dbDrive: this.dbDrive,\n        dbPassword: this.dbPassword,\n        dbUser: this.dbUser,\n        dbServerIp: this.dbServerIp,\n        dbServerName: this.dbServerName,\n        dbKeepDays: this.dbKeepDays,\n        dbShowLogbook: this.dbShowLogbook,\n        dbShowHistory: this.dbShowHistory,\n        dbInclude: load(this.dbInclude),\n        dbExclude: load(this.dbExclude, {}),\n      });\n\n      this.errorDbInfo = result.error;\n      this.messageDbInfo = result.info;\n    } catch (err) {\n      // eslint-disable-next-line\n      this.errorDbInfo = err;\n    }\n\n    this.dbConnectionValidating = false;\n  }\n\n  private dbShowLogbookChanged(ev) {\n    const newVal = ev.target.checked;\n    if (newVal !== this.dbShowLogbook) {\n      this.dbShowLogbook = newVal;\n      if (this.dbShowLogbook && this.isNotSeleced(this.dbEngine)) {\n        this.dbEngine = \"SQLite (memory)\";\n      }\n      this.saveDbSettings();\n    }\n  }\n\n  private dbShowHistoryChanged(ev) {\n    const newVal = ev.target.checked;\n    if (newVal !== this.dbShowHistory) {\n      this.dbShowHistory = newVal;\n      if (this.dbShowHistory && this.isNotSeleced(this.dbEngine)) {\n        this.dbEngine = \"SQLite (memory)\";\n      }\n      this.saveDbSettings();\n    }\n  }\n\n  private dbEngineChanged(ev) {\n    const newVal = ev.target!.selected.value;\n    if (newVal !== this.dbEngine) {\n      this.dbEngine = newVal;\n      if (this.isNotSeleced(newVal)) {\n        this.dbShowHistory = false;\n        this.dbShowLogbook = false;\n        this.saveDbSettings();\n      }\n      if (newVal === \"SQLite (memory)\") {\n        this.saveDbSettings();\n      }\n      if (newVal === \"SQLite (file)\") {\n        this.dbDrive = \"-\";\n      }\n    }\n  }\n\n  private dbDriveChanged(ev) {\n    const newVal = ev.target!.selected.value;\n    if (newVal !== this.dbDrive) {\n      this.dbDrive = newVal;\n    }\n  }\n\n  private dbUserChanged(ev) {\n    const newVal = ev.detail.value;\n    if (newVal !== this.dbUser) {\n      this.dbUser = newVal;\n    }\n  }\n\n  private dbPasswordChanged(ev) {\n    const newVal = ev.detail.value;\n    if (newVal !== this.dbPassword) {\n      this.dbPassword = newVal;\n    }\n  }\n\n  private dbServerIpChanged(ev) {\n    const newVal = ev.detail.value;\n    if (newVal !== this.dbServerIp) {\n      this.dbServerIp = newVal;\n    }\n  }\n\n  private dbServerNameChanged(ev) {\n    const newVal = ev.detail.value;\n    if (newVal !== this.dbServerName) {\n      this.dbServerName = newVal;\n    }\n  }\n\n  private dbKeepDaysChanged(ev) {\n    const newVal = ev.detail.value;\n    if (newVal !== this.dbKeepDays) {\n      this.dbKeepDays = newVal;\n    }\n  }\n\n  private dbIncludeChanged(ev) {\n    ev.stopPropagation();\n    if (ev.detail.value.replace(/\\s/g, \"\").length > 0) {\n      this.dbInclude = ev.detail.value;\n    }\n  }\n\n  private dbExcludeChanged(ev) {\n    ev.stopPropagation();\n    if (ev.detail.value.replace(/\\s/g, \"\").length > 0) {\n      this.dbExclude = ev.detail.value;\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-config-ais-dom-config-logs\": HaConfigAisDomConfiglLogs;\n  }\n}\n"],"names":[],"sourceRoot":""}