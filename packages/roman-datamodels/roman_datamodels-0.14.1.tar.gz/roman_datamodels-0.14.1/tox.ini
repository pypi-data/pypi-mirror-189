[tox]
envlist= py38,py310,style
isolated_build = True

[testenv]
extras= test
# astropy will complain if the home directory is missing
passenv= HOME
commands=
    pytest

[testenv:egg_info]
deps=
commands=
    python setup.py egg_info

[testenv:twine]
deps=
    twine
commands=
    twine check {distdir}/*

[testenv:style]
skip_install = true
description = Run all style and file checks with pre-commit
deps =
    pre-commit
commands =
    pre-commit install-hooks
    pre-commit run {posargs:--color always --all-files --show-diff-on-failure}

[testenv:coverage]
deps=
    codecov
    coverage
commands=
    coverage run --source=roman_datamodels -m pytest
    coverage report -m
    codecov -e TOXENV
passenv=
    TOXENV
    CI
    CODECOV_*
    HOME
    CRDS_*

[testenv:build-docs]
basepython= python3.8
extras= docs
commands=
    sphinx-build -W docs build/docs
