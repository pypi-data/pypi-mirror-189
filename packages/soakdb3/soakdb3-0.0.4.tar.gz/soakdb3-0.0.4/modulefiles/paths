#%Module -*- tcl -*-

proc ModulesHelp { } {
  puts stderr "\tSets up the environment for soakdb3 commands."
  puts stderr "\tRequires that the BEAMLINE (caps) and visit (not caps) environment variables be defined before the module load."
}

module-whatis "sets up the environment for soakdb3 commands"

# The soakdb3 main config file is per-visit.
setenv SOAKDB3_CONFIGFILE $workflows_directory/configurations/multibox.yaml

# The soakdb3 conda environment we want to use.
set conda_environment_version edge
set conda_environment /dls_sw/apps/soakdb3/conda/envs/soakdb3/$conda_environment_version

# Function to display versions.
set soakdb3_about "$conda_environment/bin/python -m soakdb3_cli.main --about"
set-alias "soakdb3_about" $soakdb3_about

# Function to start all the services.
set-alias "soakdb3_start" "$conda_environment/bin/python -m soakdb3_cli.main start_services all"

# Function to tail the log file.
set-alias "soakdb3_logtail" "tail -f /tmp/logs/soakdb3/logformatter.log"

# Where the soakdb3 python packages are.
prepend-path	PYTHONPATH		$conda_environment/lib/python3.10/site-packages/

# Display the versions of things.
puts stdout "$soakdb3_about;"
