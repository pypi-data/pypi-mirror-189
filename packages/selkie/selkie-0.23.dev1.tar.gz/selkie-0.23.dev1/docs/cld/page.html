<html>
<head>
<title>Page</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="../default.css"/>
</head>
<body>
<h1>Page</h1>
<p class="nav"><a href="index.html"><i>CLD Developer's Guide</i></a></p>

<h2 id="PageEditor">PageEditor</h2>

<h3 id="Pages">Pages and PageEditor</h3>
<p>
A <b>page</b> is either a written page or a recording.  Viewed as a
page, a recording's content is its transcript, which always exists,
though it may be empty.  A page is represented by a Text instance,
since the page contents generally resides in multiple members of Text.
The original-language <b>plaintext</b> resides either in <tt>orig</tt>
or <tt>xscript</tt>, and the reference-language <b>translation</b> is
in <tt>trans</tt>.</p>
<p>
A <a href="../seal/cld/ui/page.html#PageEditor">PageEditor</a>
provides a UI view of a page.  The page resides in its <tt>file</tt>
member.</p>
<pre class="source">
>>> ped = app.follow('/langs/lang.oji/texts/text.3/toc/text.1/page')
>>> ped
&lt;seal.cld.ui.page.PageEditor object at 0x...>
>>> ped.file
&lt;Text langs/oji/texts/26/toc/14>
>>> ped.file.title()
'Lesson 8: Intransitive Inanimate Verbs'
</pre>
<p>
The PageEditor constructor takes three arguments: the parent (of
class <tt>TextEditor</tt>), the text (of class <tt>Text</tt>), and
optionally the string <tt>'nt'</tt> standing for "no translation."
The parent is accessible in the member <tt>__parent__</tt>, the text is
accessible in the member <tt>file</tt>, and whether or not a
translation should be included is recorded in the member
<tt>parallel</tt>:</p>
<pre class="source">
>>> ped.parallel
True
>>> tmp = app.follow('/langs/lang.oji/texts/text.3/toc/text.1/page.nt')
>>> tmp.parallel
False
</pre>

<h3 id="Edit">Edit</h3>
<p>
The main view of a page is provided by the <a href="../seal/cld/ui/page.html#PageEditor.edit"><tt>PageEditor.edit()</tt></a> method.
The displayed HTML page includes a number of links:</p>
<ul>
<li>a 'Transcribe' button linking to <tt>xscript/edit</tt>
  or <tt>audio/edit</tt>, as appropriate.
  See <a href="xscript.html#Transcription">Transcription</a>.</li>
<li>...</li>
</ul>
<p>
The home page is generated by the <tt>edit()</tt> method.
<tt>PlainTextPanel</tt> represents the central HTML element that displays
text with translation.
The PlainTextPanel contains javascript that may place a callback
to the PageEditor method <tt>edit_par()</tt>.
It is described in the javascript section below.</p>

<h3 id="Stub">Stub</h3>
<p>
Since this is a page, it has no <tt>toc</tt>.
If it also has no <tt>plaintext()</tt>, then it is a stub.
</p>

<h2 id="PlainTextPanel">PlainTextPanel</h2>

<h3>PlainTextPanel widget</h3>
<p>
A PlainTextPanel is a widget.  The constructor takes four
arguments: the HTML page, the text's plaintext, the text's translation
(that is, the <tt>trans</tt> member), and a boolean <tt>parallel</tt> indicating whether
the translation should be displayed or not.
The panel renders as an H2 title "Text" followed by
a div that contains a table.  If <tt>parallel</tt> is true, there are
two columns in the table, with the
left column consisting of target-language paragraphs and the right column
consisting of English translations.  If <tt>parallel</tt> is false, the
right column is suppressed.</p>
<p>
The div has ID <tt>textdiv</tt>.
The table has class ParallelText if there are two columns and
PlainText if there is only one.
Existing paragraphs are included in the generated HTML table.
New paragraphs are generated by javascript.</p>
<p>
If the plaintext is of class TokenFile, it is editable.
Otherwise, the plaintext is a TranslationUnits object
representing a view of a transcript, in which case
it is read-only.</p>

<h3 id="PlainTextPanel.js">PlainTextPanel.js</h3>
<p>
<a href="../seal/js/PlainTextPanel.html">PlainTextPanel.js</a> is activated by a call <tt>PlainTextPanel(<i>w,d</i>)</tt>,
where <i>w</i> indicates whether the text is writable or not
and <i>d</i> indicates whether this text is derived from
an underlying transcription or not.
The PlainTextPanel instance contains the main control methods.</p>
<p>
The script interacts with the server at five points.  Two of them are
merely buttons that cause a new page to be requested:</p>
<ul>
<li>The "IGT" button visits the page <tt>igt.<i>i</i>/edit</tt>, where <i>i</i>
  is the current paragraph (row) number.</li>
<li>The "audio" button visits the page <tt>../audio/tunit.<i>i</i></tt>,
  where <i>i</i> is the current paragraph (row) number.</li>
</ul>
<p>
The remaining three points of interaction are ajax calls.  All are
calls to the same server-side method, namely, <tt>edit_par()</tt>.
Each nominally applies to a single cell of the matrix.
In the callback, one specifies an operation and the text that the user entered.</p>
<ul>
<li>The main interaction with the user is when the user enters a
paragraph in the text box.  When 'enter' is pressed or 'commit'
is clicked, a callback is placed.  The operation is <tt>'insert'</tt> if this is a new
paragraph and <tt>'replace'</tt> if it is an old paragraph.</li>
<li>If the text box is empty when the user finishes, and the
paragraph is not a new one, a callback is placed whose operation is
<tt>'delete'</tt>.</li>
<li>If the user clicks the little 'X' button inside a box, a
  callback is placed with operation <tt>'delete'</tt>.</li>
</ul>
<p>
The server-side method is <tt>edit_par(<i>op, i, j, s</i>)</tt>.
As we have seen, <i>op</i> is one of <tt>'insert'</tt>, <tt>'replace'</tt>, or <tt>'delete'</tt>,
<i>i</i> is the paragraph (row) number and <i>j</i> is the column number (0 =
original, 1 = translation), and <i>s</i> is the (ASCII) text that the user
entered.  <i>S</i> is ignored if <i>op</i> is <tt>'delete'</tt>.
The callback nominally applies to only one cell of the matrix: <i>j</i> is
required to be either <tt>'0'</tt> or <tt>'1'</tt>.
However, deletion affects the entire row,
and insertion is only permitted with <i>j</i> = <tt>'0'</tt>, and causes an empty
translation cell to be inserted.
The argument <i>s</i> is the text that the user typed into the text box; it is
only meaningful for <tt>'insert'</tt> and <tt>'replace'</tt>.
In the cases where <i>s</i> is provided, the script
expects the server to send back an answer, which is the text in the
native orthography (Unicode) for display.</p>
<p>
The calls are passed on to the <tt>PageWriter</tt> for the editor's page.
Specifically, an <tt>'insert'</tt> call translates to <tt>insert_par(<i>s,i</i>)</tt>;
an <tt>'insert'</tt> call translates to <tt>set_orig(<i>i,s</i>)</tt>
if <i>j</i> is <tt>'0'</tt> and <tt>set_trans(<i>i,s</i>)</tt> if <i>j</i> is
<tt>'1'</tt>; and a <tt>'delete'</tt> call translates to <tt>delete_par(<i>i</i>)</tt>.
In addition, <i>s</i> is converted to Unicode, using the text's
romanization if <i>j</i> is <tt>'0'</tt> and the default romanization if <i>j</i>
is <tt>'1'</tt>, and the Unicode is sent back to the script.</p>

</body>
</html>
