!function(){function a(a,t,e,s){var r;switch(this.bufferSize=a,this.sampleRate=t,this.bandwidth=2/a*(t/2),this.sinTable=new Float32Array(a),this.cosTable=new Float32Array(a),this.windowValues=new Float32Array(a),this.reverseTable=new Uint32Array(a),this.peakBand=0,this.peak=0,e){case"bartlett":for(r=0;r<a;r++)this.windowValues[r]=2/(a-1)*((a-1)/2-Math.abs(r-(a-1)/2));break;case"bartlettHann":for(r=0;r<a;r++)this.windowValues[r]=.62-.48*Math.abs(r/(a-1)-.5)-.38*Math.cos(2*Math.PI*r/(a-1));break;case"blackman":for(s=s||.16,r=0;r<a;r++)this.windowValues[r]=(1-s)/2-.5*Math.cos(2*Math.PI*r/(a-1))+s/2*Math.cos(4*Math.PI*r/(a-1));break;case"cosine":for(r=0;r<a;r++)this.windowValues[r]=Math.cos(Math.PI*r/(a-1)-Math.PI/2);break;case"gauss":for(s=s||.25,r=0;r<a;r++)this.windowValues[r]=Math.pow(Math.E,-.5*Math.pow((r-(a-1)/2)/(s*(a-1)/2),2));break;case"hamming":for(r=0;r<a;r++)this.windowValues[r]=.54-.46*Math.cos(2*Math.PI*r/(a-1));break;case"hann":case void 0:for(r=0;r<a;r++)this.windowValues[r]=.5*(1-Math.cos(2*Math.PI*r/(a-1)));break;case"lanczoz":for(r=0;r<a;r++)this.windowValues[r]=Math.sin(Math.PI*(2*r/(a-1)-1))/(Math.PI*(2*r/(a-1)-1));break;case"rectangular":for(r=0;r<a;r++)this.windowValues[r]=1;break;case"triangular":for(r=0;r<a;r++)this.windowValues[r]=2/a*(a/2-Math.abs(r-(a-1)/2));break;default:throw Error("No such window function '"+e+"'")}for(var h=1,i=a>>1;h<a;){for(r=0;r<h;r++)this.reverseTable[r+h]=this.reverseTable[r]+i;h<<=1,i>>=1}for(r=0;r<a;r++)this.sinTable[r]=Math.sin(-Math.PI/r),this.cosTable[r]=Math.cos(-Math.PI/r);this.calculateSpectrum=function(a){var t,e,s,r=this.bufferSize,h=this.cosTable,i=this.sinTable,o=this.reverseTable,n=new Float32Array(r),l=new Float32Array(r),w=2/this.bufferSize,f=Math.sqrt,c=new Float32Array(r/2),u=Math.floor(Math.log(r)/Math.LN2);if(Math.pow(2,u)!==r)throw new Error("Invalid buffer size, must be a power of 2.");if(r!==a.length)throw new Error("Supplied buffer is not the same size as defined FFT. FFT Size: "+r+" Buffer Size: "+a.length);for(var M,b,d,p,v,k,m,I,T=1,V=0;V<r;V++)n[V]=a[o[V]]*this.windowValues[o[V]],l[V]=0;for(;T<r;){M=h[T],b=i[T],d=1,p=0;for(var F=0;F<T;F++){for(var P=F;P<r;)k=d*n[v=P+T]-p*l[v],m=d*l[v]+p*n[v],n[v]=n[P]-k,l[v]=l[P]-m,n[P]+=k,l[P]+=m,P+=T<<1;d=(I=d)*M-p*b,p=I*b+p*M}T<<=1}for(var g=0,S=r/2;g<S;g++)(s=w*f((t=n[g])*t+(e=l[g])*e))>this.peak&&(this.peakBand=g,this.peak=s),c[g]=s;return c}}onmessage=function(t){for(var e=t.data,s=e.width,r=e.start,h=e.end,i=e.fftSamples,o=[],n=(h-r)/s,l=Math.min(i-1,Math.max(i-1,Math.round(i-n))),w=new a(e.fftSamples,e.sampleRate,e.windowFunc,e.alpha),f=0;f<1;f++){for(var c=e.channelData,u=[],M=r;M+i<h;){var b=c.slice(M,M+i),d=w.calculateSpectrum(b),p=new Uint8Array(i/2),v=void 0;for(v=0;v<i/2;v++)p[v]=Math.max(-255,45*Math.log10(d[v]));u.push(p),M+=i-l}o.push(u)}postMessage(o[0])}}();